#!/bin/bash

set -ex

#if [[ "$OSTYPE" == "darwin"* ]]; then
#  # Mac
#  MINOTAUR_SHAREDLIB=minotaur.dylib
#else
#  # Linux
#  MINOTAUR_SHAREDLIB=@CACHE_EXPRS_PASS.so
#fi

TV_REPORT_DIR=-minotaur-report-dir=@CMAKE_BINARY_DIR@/logs
TV_SMT_TO=-minotaur-query-to=20000
DEBUG=true

SKIP=0

for arg do
  shift
  [ $arg==-passes* ] && continue
  [ $arg==-O* ] && continue
  set -- "$@" "$arg"
done
echo "foo$@"

if [[ $SKIP == 0 ]]; then
@LLVM_BINARY_DIR@/bin/opt -load-pass-plugin=@ONLINE_PASS@ \
  -passes="minotaur-online" \
  $@ \
  -minotaur-enable-caching=$DEBUG \
  -minotaur-ignore-machine-cost=$DEBUG \
  -minotaur-debug-enumerator=$DEBUG \
  -minotaur-debug-codegen=$DEBUG \
  $TV_REPORT_DIR
else
@LLVM_BINARY_DIR@/bin/opt
fi
